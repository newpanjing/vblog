---
title: Django+whoosh 全文检索中文分词问题
---

# Django+whoosh 全文检索中文分词问题

<p>django使用whoosh全文检索，到处都是坑。如果用java来写，那就方便多了。</p><h4>第一个坑，中文不支持</h4><p>只能自己改下源码。使用了jieba的中文分词<br/></p><p><img src="https://oss.88cto.com/tnIkNxG3.png" title="" alt="tnIkNxG3.png"/></p><h4>第二个坑</h4><p>搜索关键词问题，假如索引中有以下数据：<br/></p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p><span style="text-decoration: underline;">Java是世界上最好的语言</span></p></li><li><p><span style="text-decoration: underline;">Django是最好用的web框架，但是处处是坑</span></p></li></ol><p><span style="text-decoration: none;">我们尝试着输入关键词搜索，例如：java、django这种单个关键词都可以准确的返回数据，</span></p><p><span style="text-decoration: none;">如我想用一句话来搜索：“java是哪个国家发明的语言呢”</span></p><p><span style="text-decoration: none;">看看分词器的结果：</span></p><p><span style="text-decoration: none;"><img src="https://oss.88cto.com/IFdfyVTe.png" title="" alt="IFdfyVTe.png"/></span></p><p><span style="text-decoration: none;"><br/></span></p><p><span style="text-decoration: none;">所有1中 java、是、的、语言，这几个词都匹配，其中：是、的，是停用词，剩下的就是 java、国家、发明、语言这两个词</span></p><p><span style="text-decoration: none;">但是你会发现搜索不到结果，你用单个词就可以搜索到。</span></p><p><span style="text-decoration: none;">这是因为whoosh 内置使用的操作符是AND，也就是必须同时满足你分词后的词语。多一个都不行。</span></p><p>那如果这样的话全文检索是没有任何意义的。于是在官方文档找到了一句这样的配置:</p><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;Menlo&#39;;font-size:9.0pt;">HAYSTACK_DEFAULT_OPERATOR&nbsp;=&nbsp;&#39;OR&#39;</pre><p>settings.py中加入默认操作符配置。</p><p>配置好了之后，进行搜索还是不行，默认还是AND操作符。</p><p>调试分析，这会从settings.py中取到我们预设的操作符：<br/></p><p><img src="https://oss.88cto.com/Q0l9wqHo.png" title="" alt="Q0l9wqHo.png"/></p><p>但是在构造查询的时候 还是使用的AND</p><p><img src="https://oss.88cto.com/hmSyEmtD.png" title="" alt="hmSyEmtD.png" width="1018" height="413" style="width: 1018px; height: 413px;"/></p><p>实在不解设置了没效，那官方还说这样做有什么意义。在Google之后，很多人都有这样的问题。</p><p>大部分人的解决方案是自己重写view 然后构造自己的queryset</p><p><br/></p><p>没办法，只能自己重写查询的部分了。</p><p><br/></p>


